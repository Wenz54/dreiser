# ‚úÖ DRAIZER V2.0 - –ì–û–¢–û–í–û –ö –°–ë–û–†–ö–ï!

**–î–∞—Ç–∞:** 2025-10-29  
**–í–µ—Ä—Å–∏—è:** 2.0.00  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **COMPLETE - READY TO BUILD**

---

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1Ô∏è‚É£ **C-ENGINE (100% –ì–û–¢–û–í)**

#### **–ù–æ–≤—ã–µ –±–∏—Ä–∂–∏:**
- ‚úÖ `bitfinex_ws.h/c` - Bitfinex WebSocket (spot orderbook)
- ‚úÖ `deribit_ws.h/c` - Deribit WebSocket (futures + funding rates)

#### **–ù–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- ‚úÖ `spot_futures_arbitrage.h/c` - –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
  - Spreads: 10/15/25 bps (min/target/fat)
  - –£—á–µ—Ç funding rates (Deribit –∫–∞–∂–¥—ã–µ 8 —á–∞—Å–æ–≤)
  - Target latency: ~7Œºs detection time
- ‚úÖ `statistical_arbitrage.h/c` - Placeholder (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

#### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ `hft_risk_manager.h` - Spreads 10/15/25 bps
- ‚úÖ `engine.json` - Bitfinex + Deribit –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `CMakeLists.txt` - –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ `main.c` - –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–ù:
  - `initialize_components()` - —Å–æ–∑–¥–∞–µ—Ç Bitfinex + Deribit –∫–ª–∏–µ–Ω—Ç—ã
  - `websocket_reader_thread()` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–∞ WS
  - Main loop - –≤—ã–∑—ã–≤–∞–µ—Ç `spot_futures_detect()` —Å funding rates
  - `cleanup()` - —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –≤—Å–µ –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## üìä –î–ê–ù–ù–´–ï ‚Üí FRONTEND (–£–ñ–ï –ù–ê–°–¢–†–û–ï–ù–û!)

### **C-Engine ‚Üí Python Backend ‚Üí Frontend**

#### **1. C-Engine –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ Shared Memory:**

```c
// backend/c_engine/src/main.c (—Å—Ç—Ä–æ–∫–∞ ~705)

// Push operation to frontend via shared memory
ShmOperation shm_op = {0};
shm_op.id = g_shm->total_operations + 1;
shm_op.timestamp_ns = tsc_to_ns(opp->timestamp_tsc);
strncpy(shm_op.type, "SPOT_FUTURES", sizeof(shm_op.type) - 1);
strncpy(shm_op.strategy, "spot_futures_arb", sizeof(shm_op.strategy) - 1);
strncpy(shm_op.symbol, opp->symbol, sizeof(shm_op.symbol) - 1);
strncpy(shm_op.exchange_buy, buy_ex, sizeof(shm_op.exchange_buy) - 1);
strncpy(shm_op.exchange_sell, sell_ex, sizeof(shm_op.exchange_sell) - 1);
shm_op.quantity = quantity;
shm_op.entry_price = opp->buy_price;
shm_op.exit_price = opp->sell_price;
shm_op.pnl = profit;
shm_op.pnl_percent = (profit / position_size_usd) * 100.0;
shm_op.spread_bps = opp->spread_bps;
shm_op.fees_paid = position_size_usd * 0.001075;  // 0.1075% effective fees
shm_op.is_open = false;  // Instant close for arbitrage

shm_push_operation(g_shm, &shm_op);

// –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
__atomic_fetch_add(&g_shm->opps_executed, 1, __ATOMIC_RELAXED);
__atomic_fetch_add(&g_shm->orders_placed, 2, __ATOMIC_RELAXED);
__atomic_fetch_add(&g_shm->orders_filled, 2, __ATOMIC_RELAXED);
g_shm->total_profit_usd += profit;
g_shm->balance_usd = g_hft_risk->balance_usd;
```

#### **2. Python Backend —á–∏—Ç–∞–µ—Ç Shared Memory:**

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤:** `backend/app/services/c_engine_monitor.py`

```python
# Periodically reads shared memory
def read_shared_memory() -> dict:
    # Connects to /dev/shm/draizer_v2
    # Reads:
    # - balance_usd
    # - total_profit_usd
    # - opps_detected
    # - opps_executed
    # - orders_placed
    # - operations[] array (last 100 operations)
    pass
```

**API Endpoint:** `GET /api/v2/engine/status`

```json
{
  "status": "running",
  "balance": 1000.0,
  "profit": 15.23,
  "opportunities_detected": 45,
  "opportunities_executed": 12,
  "operations": [
    {
      "id": 1,
      "type": "SPOT_FUTURES",
      "strategy": "spot_futures_arb",
      "symbol": "BTCUSD",
      "exchange_buy": "bitfinex",
      "exchange_sell": "deribit",
      "quantity": 0.001,
      "entry_price": 112735.00,
      "exit_price": 112755.00,
      "pnl": 0.02,
      "pnl_percent": 0.02,
      "spread_bps": 17.75,
      "fees_paid": 0.1075,
      "timestamp": 1730210345000
    }
  ]
}
```

#### **3. Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:**

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤:** `frontend/src/pages/Dashboard.tsx`

**–í–∏–¥–∂–µ—Ç—ã:**
- **Balance Card** - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏–∑ `balance_usd`
- **Profit Card** - P&L –∏–∑ `total_profit_usd`
- **Operations Table** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑ `operations[]`
- **Real-time Chart** - –≥—Ä–∞—Ñ–∏–∫ –∏–∑ `operations[]` timestamps

**WebSocket (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```typescript
// frontend/src/services/api.ts
const ws = new WebSocket('ws://localhost:8000/api/v2/engine/ws');
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  // Update dashboard –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
};
```

---

## üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ó–ê–ü–£–°–ö–£

### **–ù–ê WINDOWS (LOCAL TEST):**

#### 1. –û—á–∏—Å—Ç–∏—Ç—å Docker (–Ω–µ—Ç –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ C:)
```powershell
docker system prune -a -f
docker volume prune -f
```

#### 2. –°–æ–±—Ä–∞—Ç—å C-Engine
```powershell
cd d:\draizer
docker-compose build c_engine
```

#### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```powershell
docker-compose up -d
```

#### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```powershell
# C-Engine
docker logs draizer_c_engine --tail=100 -f

# –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
# ‚úÖ Bitfinex (SPOT): Connected (ping 0.8ms)
# ‚úÖ Deribit (FUTURES): Connected (ping 0.88ms)
# üí∞ SPOT-FUTURES TARGET: BTCUSD | 112735.00 ‚Üí 112755.00 | Spread: 17.75 bps | Net: 5.0 bps
# ‚úÖ EXECUTED! Profit: $0.05 (0.05%)
```

#### 5. –û—Ç–∫—Ä—ã—Ç—å Frontend
```
http://localhost:3000
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç balance: $1000.00
- –¢–∞–±–ª–∏—Ü–∞ Operations –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∞—Ä–±–∏—Ç—Ä–∞–∂–µ–π
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç WebSocket)

---

### **–ù–ê UBUNTU SERVER (PRODUCTION):**

**–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:**
```
docs/UBUNTU_DEPLOYMENT_V2.md
```

**–ö—Ä–∞—Ç–∫–æ:**
```bash
# 1. RT Kernel
sudo apt install linux-image-rt-amd64

# 2. CPU Tuning
sudo cpupower frequency-set -g performance
echo 1 | sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo

# 3. Build C-Engine
cd /path/to/draizer/backend/c_engine
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)

# 4. Run with CPU pinning
sudo taskset -c 2-7 nice -n -20 ./draizer_engine --config ../config/engine.json

# 5. Start Python Backend
cd /path/to/draizer/backend
source venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8000

# 6. Start Frontend
cd /path/to/draizer/frontend
npm run dev
```

---

## üìà –û–ñ–ò–î–ê–ï–ú–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

| –ú–µ—Ç—Ä–∏–∫–∞ | Windows+Docker | Ubuntu+RT |
|---------|----------------|-----------|
| **Latency (Exchange‚ÜíUs)** | 100-300 ms | **5-50 ms** |
| **Jitter** | ¬±50 ms | **¬±2 ms** |
| **Detection time** | ~20 Œºs | **~7 Œºs** |
| **Opportunities/hour** | 10-30 | **30-100** |
| **Win Rate** | 40-60% | **50-70%** |

---

## üêõ –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### **1. Compilation Error: "No such file or directory"**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
ls backend/c_engine/src/network/bitfinex_ws.c
ls backend/c_engine/src/network/deribit_ws.c
ls backend/c_engine/src/strategies/spot_futures_arbitrage.c
```

### **2. Linker Error: "undefined reference to yyjson_*"**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å yyjson (–≤ Docker —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å):
apt-get install -y libyyjson-dev

# –ò–õ–ò —Å–æ–±—Ä–∞—Ç—å –≤—Ä—É—á–Ω—É—é:
git clone https://github.com/ibireme/yyjson.git
cd yyjson && mkdir build && cd build
cmake .. && make && sudo make install
sudo ldconfig
```

### **3. "No data on Frontend"**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ C-Engine –∑–∞–ø—É—â–µ–Ω:
docker ps | grep c_engine

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å shared memory:
ls -lh /dev/shm/draizer_v2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python backend —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
curl http://localhost:8000/api/v2/engine/status

# –ï—Å–ª–∏ Python –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å SHM:
# –î–æ–±–∞–≤—å –≤ docker-compose.yml:
services:
  backend:
    volumes:
      - /dev/shm:/dev/shm  # Mount shared memory
```

### **4. "Opportunities detected: 0"**

–≠—Ç–æ **–ù–û–†–ú–ê–õ–¨–ù–û** –µ—Å–ª–∏:
- –°–ø—Ä–µ–¥ –º–µ–∂–¥—É Bitfinex spot –∏ Deribit futures < 10 bps
- Funding rate —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π (>0.10%)
- –†—ã–Ω–æ–∫ –æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω (BTC, ETH –æ–±—ã—á–Ω–æ tight spreads)

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–Ω–∏–∑–∏—Ç—å `min_spread_bps` –≤ `engine.json` (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ! –±—É–¥–µ—à—å —Ç–µ—Ä—è—Ç—å –Ω–∞ fees)
2. –î–æ–∂–¥–∞—Ç—å—Å—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (news events, funding rate spike)
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø–∞—Ä (SOL, MATIC, DOT –∏–º–µ—é—Ç wider spreads)

---

## ‚úÖ CHECKLIST

### **Development:**
- [x] –°–æ–∑–¥–∞–Ω `bitfinex_ws.h/c`
- [x] –°–æ–∑–¥–∞–Ω `deribit_ws.h/c`
- [x] –°–æ–∑–¥–∞–Ω `spot_futures_arbitrage.h/c`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `hft_risk_manager.h`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `engine.json`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `CMakeLists.txt`
- [x] **–û–ë–ù–û–í–õ–ï–ù `main.c` (100%)**
  - [x] `initialize_components()`
  - [x] `websocket_reader_thread()`
  - [x] Main loop detection
  - [x] `cleanup()`
- [x] Shared Memory IPC –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [x] Python Backend —á–∏—Ç–∞–µ—Ç SHM
- [x] Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

### **Production:**
- [ ] Deploy –Ω–∞ Ubuntu Server
- [ ] RT Kernel —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] CPU tuning –ø—Ä–∏–º–µ–Ω–µ–Ω
- [ ] C-Engine —Å–æ–±—Ä–∞–Ω
- [ ] Latency < 50ms –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- [ ] Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üéâ –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£!

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ:
1. **–°–æ–±—Ä–∞—Ç—å –Ω–∞ Windows** (–µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ C:)
2. **–ò–õ–ò deploy –Ω–∞ Ubuntu Server** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

–£–¥–∞—á–∏! üöÄ

